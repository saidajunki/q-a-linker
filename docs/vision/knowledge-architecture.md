# QALinker ナレッジアーキテクチャ

## 1. 概要

QALinkerに蓄積されるナレッジは、単なるQ&Aの履歴ではない。
**時間軸を持った構造化された知識ベース**として設計する。

これにより：
- 過去のナレッジを適切な文脈で参照できる
- 「今」の質問に対して、時代に合った回答を提供できる
- 必要に応じて「過去の時点での回答」も取得できる

---

## 2. 知識の時間的分類（Temporal Classification）

ナレッジは以下の4つのカテゴリに分類される：

### 2.1 普遍的知識（Timeless）

時代を超えて変わらない知識。

**例**：
- 数学の定理、物理法則
- 人間関係の基本原則
- 論理的思考の方法
- 基本的な調理技術

**特徴**：
- パーティション不要
- 常に参照可能
- 鮮度スコアの減衰なし

### 2.2 緩やかに変化する知識（Slow-changing）

数年〜数十年単位で変化する知識。

**例**：
- 料理のトレンド
- コミュニケーションの慣習
- ビジネスマナー
- 教育方法論

**特徴**：
- 大きな時代区分でパーティション（例：2020年代）
- 参照時に「時代背景」を付記
- 緩やかな鮮度スコア減衰

### 2.3 バージョン依存の知識（Version-bound）

特定のバージョン・製品に紐づく知識。

**例**：
- プログラミング言語の文法（Python 3.9 vs 3.12）
- フレームワークの使い方（React 17 vs 18）
- OS・ツールの操作方法
- APIの仕様

**特徴**：
- バージョンタグでパーティション
- 複数バージョンが並存可能
- 「どのバージョンの話か」を明示

### 2.4 時点依存の知識（Time-sensitive）

特定の時点でのみ有効な知識。

**例**：
- 法律・税制（毎年変わる）
- 相場・市場情報
- 制度・手続き
- イベント・キャンペーン情報

**特徴**：
- 年・月単位でパーティション
- 有効期限を明示
- 参照時に「この情報は〇〇年時点のものです」と警告
- 急速な鮮度スコア減衰

---

## 3. パーティション設計

### 3.1 パーティションの概念

DBのパーティションのように、ナレッジベース内に「壁」を立てる。

```
ナレッジベース
├── [Timeless] 普遍的知識
│   └── （パーティションなし、単一空間）
│
├── [Slow-changing] 緩やかに変化する知識
│   ├── 2010年代
│   ├── 2020年代
│   └── ...
│
├── [Version-bound] バージョン依存の知識
│   ├── React
│   │   ├── v17
│   │   ├── v18
│   │   └── v19
│   ├── Python
│   │   ├── 3.9
│   │   ├── 3.10
│   │   └── ...
│   └── ...
│
└── [Time-sensitive] 時点依存の知識
    ├── 2024年
    │   ├── Q1
    │   ├── Q2
    │   └── ...
    ├── 2025年
    └── ...
```

### 3.2 パーティションの自動判定

質問の構造化時に、AIが以下を推定：
- どの時間的分類に属するか
- どのパーティションに格納すべきか
- 有効期限の推定

### 3.3 クロスパーティション参照

必要に応じて、複数のパーティションを横断して参照可能：
- 「React 17と18の違いを教えて」→ 両バージョンのパーティションを参照
- 「去年と今年の確定申告の変更点」→ 2024年と2025年のパーティションを比較

---

## 4. 時間軸を行ったり来たりする機能

### 4.1 デフォルト動作

質問時に特に指定がなければ、**現在の時点**に最適なナレッジを返す。

### 4.2 過去時点の参照

ユーザーが明示的に過去の時点を指定できる：
- 「2023年時点でのReact 17の書き方」
- 「去年の確定申告のルール」

### 4.3 時系列比較

複数の時点を比較する機能：
- 「Pythonの型ヒントは、3.9から3.12でどう変わった？」
- 「消費税の計算方法は、2019年と2024年でどう違う？」

### 4.4 変遷の可視化

知識の変化を時系列で追える：
- 「この技術はどのように進化してきたか」
- 「なぜ今のやり方になったのか」の文脈提供

---

## 5. 地理的・文化的パーティション

時間軸に加えて、地理的・文化的な軸も考慮：

### 5.1 地域タグ

- グローバル（どの地域でも共通）
- 日本
- US
- EU
- ...

### 5.2 地域依存の知識

- 法律・規制（国ごとに異なる）
- 税制（国・地域ごとに異なる）
- ビジネス慣習（文化圏ごとに異なる）
- 言語表現（地域差がある）

### 5.3 クロスリージョン参照

- 「日本とアメリカで、この手続きはどう違う？」
- 「グローバルに通用するやり方は？」

---

## 6. 実装上の考慮事項

### 6.1 メタデータスキーマ

```
KnowledgeRecord {
  id: string
  content: {
    question: string
    answer: string
    mergedAnswer: string  // 統合回答
  }
  
  // 時間的分類
  temporalClass: 'timeless' | 'slow-changing' | 'version-bound' | 'time-sensitive'
  
  // パーティション情報
  partition: {
    version?: string      // バージョン依存の場合
    year?: number         // 時点依存の場合
    quarter?: number      // 時点依存の場合（より細かい粒度）
    era?: string          // 緩やかに変化する場合（例：'2020s'）
  }
  
  // 地理的情報
  region: 'global' | 'japan' | 'us' | 'eu' | ...
  
  // 有効性
  validFrom: Date
  validUntil?: Date       // 推定有効期限
  freshnessScore: number  // 0-1、時間経過で減衰
  
  // メタ情報
  createdAt: Date
  updatedAt: Date
  category: string[]
  level: 'beginner' | 'intermediate' | 'advanced'
}
```

### 6.2 クエリ時の処理

1. 質問を構造化
2. 時間的文脈を推定（現在？過去？比較？）
3. 地理的文脈を推定
4. 適切なパーティションを特定
5. ナレッジを検索
6. 文脈の一致度を評価
7. 結果を返却（必要に応じて警告を付記）

### 6.3 鮮度スコアの計算

```
freshnessScore = baseScore * decayFunction(age, temporalClass)

decayFunction:
  - timeless: 減衰なし（常に1.0）
  - slow-changing: 10年で0.5に減衰
  - version-bound: 新バージョンリリースで急減衰
  - time-sensitive: 1年で0.5に減衰、有効期限後は0
```

---

## 7. 設計判断の指針

ナレッジアーキテクチャに関する判断に迷った際は、以下の問いに立ち返る：

1. **時間的文脈は適切に分類されているか？** 普遍的知識を時点依存として扱っていないか、逆も然り
2. **パーティションは適切な粒度か？** 細かすぎると管理が煩雑、粗すぎると精度が落ちる
3. **過去の知識へのアクセスは保証されているか？** 古いからといって削除しない
4. **文脈の警告は適切か？** 「この情報は〇〇年時点」という注記が必要な場面で出ているか
5. **クロスパーティション参照は可能か？** 比較・変遷の追跡ができるか
