# 常に遵守すべきルール

このファイルには、どのような作業においても常に考慮すべき価値観と優先順位を記載します。

## プロジェクト概要

**QALinker** - AIが仲介に徹し、人間が答えるQ&Aプラットフォーム

## 開発手法

### 仕様書駆動開発 + テスト駆動開発（Spec-Driven + TDD）

このプロジェクトでは以下のサイクルで開発を進める：

1. **仕様書を作成・更新**（`docs/`）
2. **仕様に基づいてテストを作成・更新**
3. **テストが通るように実装**
4. 1に戻る

#### 重要な原則
- 仕様変更時は、まずテストを変更する
- テストが先、実装が後（Red → Green → Refactor）
- テストの実装に時間をかけることを厭わない

## 優先順位（重要度順）

### 1. ビジョンとの整合性
- `docs/vision/` ディレクトリのビジョンドキュメントがSource of Truth
- 特に `philosophy.md` の「設計判断の指針」を常に参照
- 機能追加時は「AIは仲介に徹しているか」を確認

### 2. 仕様書との整合性
- 仕様書に記載のない機能は実装しない
- 仕様と実装に齟齬がある場合は、仕様書を正とする
- 不明点があれば実装前に確認する

### 3. テストによる品質担保
- 仕様をテストコードで表現する
- テストが通ることで仕様通りの動作を保証

### 4. 機能の正確性（バグがないこと）
- 仕様通りに動作することが最優先
- エッジケースを考慮した実装
- 型安全性を活用してバグを防ぐ

### 5. 保守性
- 人間がコードを読む前提で書く
- 適切な抽象化を行う
- 日本語のコメントを適宜入れる
- 複雑なロジックには必ず説明を付ける

### 6. セキュリティ
- 入力値は常に検証・サニタイズ
- 認証・認可の適切な実装
- シークレット情報の適切な管理
- 個人情報の保護（QALinkerの核心的価値）

### 7. パフォーマンス
- N+1問題を起こさない
- 不要なデータ取得を避ける
- 必要に応じてキャッシュを検討

## コミット・プッシュルール

作業の境目を見つけて、適切なタイミングでコミットとプッシュを行うこと。

### コミットすべきタイミング
- 機能の実装が一区切りついたとき
- ドキュメントの追加・更新が完了したとき
- バグ修正が完了したとき
- リファクタリングが完了したとき

### コミットメッセージの形式
```
<type>: <description>

例：
feat: ユーザー認証機能の実装
fix: ログイン時のエラーハンドリング修正
docs: 設計哲学ドキュメントの追加
refactor: AIサービスの構造改善
chore: 依存関係の更新
```

### プッシュのタイミング
- コミット後は基本的にプッシュする
- 作業セッションの終了時には必ずプッシュする

## 外部参照ルール（AI駆動開発時の必須事項）

汎用的な技術ベストプラクティスはローカルに保持せず、必要に応じて外部参照する。

### 参照タイミング
- **Next.js / React 実装時**: Next.js公式ドキュメント
- **TypeScript 実装時**: TypeScript公式ドキュメント
- **テスト実装時**: Vitest / React Testing Library / Playwright 公式ドキュメント
- **セキュリティ対策時**: OWASP、Next.js Security Guide
- **アクセシビリティ対応時**: WCAG 2.2

## コミット前チェックリスト

- [ ] ビジョン（`docs/vision/philosophy.md`）との齟齬がないか
- [ ] テストが追加・更新されているか
- [ ] すべてのテストが通るか
- [ ] 型エラー・ビルドエラーがないか
- [ ] セキュリティ上の問題がないか

## ルールの継続的改善

人間からのフィードバックに、今後の開発でも一貫して意識すべき指摘が含まれていた場合は、該当するルールファイル（`rules/`配下）を更新してください。
